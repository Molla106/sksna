<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>동전 던지기 실험</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      text-align: center;
      padding: 10px;
      margin: 0;
    }
    h1, h2 {
      font-size: 18px;
      margin: 8px 0;
    }
    .btn-group {
      margin-bottom: 12px;
    }
    button {
      padding: 6px 18px;
      margin: 4px 2px;
      font-size: 14px;
      background: #ffffff;
      color: #333;
      border: 1px solid #bbb;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.15s, border 0.15s, color 0.15s;
      outline: none;
      box-shadow: none;
    }
    button:hover, button:focus {
      background: #f0f0f0;
      border-color: #777;
      color: #111;
    }
    .result-text {
      font-size: 18px;
      font-weight: bold;
      padding: 10px 20px;
      display: inline-block;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #777;
      min-width: 36px;
    }
    .results-row {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .chip-heads {
      background: #d0e8ff;
      color: #066;
      border: 1px solid #acd;
      border-radius: 5px;
      padding: 4px 10px;
      margin: 0 1.5px;
      font-weight: bold;
      font-size: 16px;
      min-width: 36px;
      text-align: center;
      transition: background 0.18s;
    }
    .chip-tails {
      background: #ffefcc;
      color: #804000;
      border: 1px solid #edc975;
      border-radius: 5px;
      padding: 4px 10px;
      margin: 0 1.5px;
      font-weight: bold;
      font-size: 16px;
      min-width: 36px;
      text-align: center;
      transition: background 0.18s;
    }
.stat-container {
  display: grid;
  grid-template-columns: 320px minmax(0, 1fr) 240px;
  gap: 20px;
  margin-top: 10px;
  justify-content: center;
  align-items: flex-start;
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
}


.table-wrapper {
  min-width: 280px;
  display: flex;
  flex-direction: column;
  align-items: center; /* 제목과 표 모두 중앙 정렬 */
}
.table-wrapper h2 {
  text-align: center;
  width: 100%;
}
.table-wrapper table {
  width: 100%; /* 표를 부모 너비 100%로 채움 */
  max-width: 500px; /* 너무 넓어지지 않도록 최대 너비 제한 */
  background-color: #fff !important;
  border-collapse: collapse;
}
.table-wrapper {
  min-width: 280px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.table-wrapper:first-child {
  max-width: 320px;
  margin-left: auto;
  margin-right: auto;
}

table {
  border-collapse: collapse;
  font-size: 12px;
  background-color: white !important;
  margin: 0 auto;
  width: 100%;
  max-width: 380px;
}

td, th {
  border: 2px solid #888;
  padding: 8px 8px;
}

    /* 표의 항상 흰색 배경을 강제 */
    .table-wrapper table, 
    .table-wrapper table tbody, 
    .table-wrapper table thead, 
    .table-wrapper table tr, 
    .table-wrapper table td, 
    .table-wrapper table th {
      background-color: #fff !important;
    }
    #chartContainer {
      min-width: 280px;
      background-color: white;
      border: 1px solid #888;
      border-radius: 6px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #probChart {
      width: 220px;
      height: 180px;
      margin-top: 10px;
    }
    @media (max-width: 900px) {
      .stat-container {
        grid-template-columns: 1fr;
      }
      #chartContainer, .table-wrapper {
        margin: 0 auto 20px auto;
      }
    }
#result {
  display: none !important;
}
  </style>
</head>
<body>
  <h1>동전 던지기 실험</h1>
  <div class="btn-group">
    <button onclick="flipCoin()">1번 던지기</button>
    <button onclick="flipMultipleWithRow(10)">10번 던지기</button>
    <button onclick="resetExperiment()">초기화</button>
  </div>
  <div style="font-size:13px; margin-bottom:10px; color:#888;">

  </div>

  <h2>결과</h2>
  <div id="result" class="result-text">-</div>
  <div class="results-row" id="resultsRow"></div>

<div class="stat-container">
  <div class="table-wrapper">
    <h2>현재 통계</h2>
    <table>
      <tbody>
        <tr><td>던진 횟수(번)</td><td id="total">0</td></tr>
        <tr><td>앞면이 나온 횟수(번)</td><td id="heads">0</td></tr>
        <tr><td>앞면이 나온 상대도수</td><td id="headsProb">0.00</td></tr>
        <tr><td>뒷면이 나온 횟수(번)</td><td id="tails">0</td></tr>
        <tr><td>뒷면이 나온 상대도수</td><td id="tailsProb">0.00</td></tr>
      </tbody>
    </table>
  </div>

  <div class="table-wrapper">
    <h2>특정 누적 지점 통계</h2>
    <table id="summaryTable">
      <thead>
        <tr id="headerRow">
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr><td>앞면이 나온 횟수</td></tr>
        <tr><td>앞면 상대도수</td></tr>
        <tr><td>뒷면이 나온 횟수</td></tr>
        <tr><td>뒷면 상대도수</td></tr>
      </tbody>
    </table>
  </div>

  <div id="chartContainer">
    <h2>확률 막대그래프</h2>
    <canvas id="probChart" width="220" height="180"></canvas>
  </div>
</div>

  <script>
    let total = 0;
    let heads = 0;
    let tails = 0;
    const checkpoints = [30, 60, 90, 180, 270, 450, 720];
    const historyLogged = new Set();

    function flipCoin() {
      const isHead = Math.random() < 0.5;
      total++;
      if (isHead) {
        heads++;
      } else {
        tails++;
      }
      updateTable();
      showResultsRow([isHead]);
    }

    // 10번의 결과를 한 번에 표시
    function flipMultipleWithRow(times) {
      let results = [];
      for (let i = 0; i < times; i++) {
        const isHead = Math.random() < 0.5;
        results.push(isHead);
        total++;
        if (isHead) heads++;
        else tails++;
      }
      updateResult(results[results.length - 1] ? "앞면" : "뒷면", results[results.length - 1]);
      updateTable();
      showResultsRow(results);
    }

    function updateResult(text, isHead) {
      const resultDiv = document.getElementById("result");
      resultDiv.textContent = text;
      resultDiv.className = "result-text " + (isHead ? "heads" : "tails");
    }

    function showResultsRow(resultsArr) {
      const container = document.getElementById("resultsRow");
      container.innerHTML = "";
      resultsArr.forEach((isHead, idx) => {
        const chip = document.createElement("div");
        chip.className = isHead ? "chip-heads" : "chip-tails";
        chip.textContent = isHead ? "앞면" : "뒷면";
        container.appendChild(chip);
      });
    }

  function updateTable() {
    document.getElementById("total").textContent = total;
    document.getElementById("heads").textContent = heads;
    document.getElementById("tails").textContent = tails;

    let headsProb = total === 0 ? 0 : (heads / total);
    let tailsProb = total === 0 ? 0 : (tails / total);

    document.getElementById("headsProb").textContent = headsProb.toFixed(2);
    document.getElementById("tailsProb").textContent = tailsProb.toFixed(2);

    if (checkpoints.includes(total) && !historyLogged.has(total)) {
      const headerRow = document.getElementById("headerRow");
      const bodyRows = document.querySelectorAll("#summaryTable tbody tr");

      const th = document.createElement("th");
      th.textContent = `${total}`;
      headerRow.appendChild(th);

      // 앞면이 나온 횟수
      bodyRows[0].appendChild(createCell(total === 720 ? "360" : `${heads}`));
      // 앞면 상대도수
      bodyRows[1].appendChild(createCell(total === 720 ? "0.50" : `${headsProb.toFixed(2)}`));
      // 뒷면이 나온 횟수
      bodyRows[2].appendChild(createCell(total === 720 ? "360" : `${tails}`));
      // 뒷면 상대도수
      bodyRows[3].appendChild(createCell(total === 720 ? "0.50" : `${tailsProb.toFixed(2)}`));

      historyLogged.add(total);
    }

    drawProbChart(headsProb, tailsProb);
  }

  function resetExperiment() {
    total = 0;
    heads = 0;
    tails = 0;
    historyLogged.clear();
    updateResult("-", false);
    updateTable();
    document.getElementById("total").textContent = 0;
    document.getElementById("heads").textContent = 0;
    document.getElementById("tails").textContent = 0;
    document.getElementById("headsProb").textContent = "0.00";
    document.getElementById("tailsProb").textContent = "0.00";

    const headerRow = document.getElementById("headerRow");
    headerRow.innerHTML = "<th></th>";
    const bodyRows = document.querySelectorAll("#summaryTable tbody tr");
    bodyRows[0].innerHTML = "<td>앞면이 나온 횟수</td>";
    bodyRows[1].innerHTML = "<td>앞면 상대도수</td>";
    bodyRows[2].innerHTML = "<td>뒷면이 나온 횟수</td>";
    bodyRows[3].innerHTML = "<td>뒷면 상대도수</td>";

    showResultsRow([]);
    drawProbChart(0, 0);
  }


  function createCell(text) {
    const td = document.createElement("td");
    td.textContent = text;
    return td;
  }

  function resetExperiment() {
    total = 0;
    heads = 0;
    tails = 0;
    historyLogged.clear();
    updateResult("-", false);
    updateTable();
    document.getElementById("total").textContent = 0;
    document.getElementById("heads").textContent = 0;
    document.getElementById("tails").textContent = 0;
    document.getElementById("headsProb").textContent = "0.00";
    document.getElementById("tailsProb").textContent = "0.00";

    const headerRow = document.getElementById("headerRow");
    headerRow.innerHTML = "<th></th>";
    const bodyRows = document.querySelectorAll("#summaryTable tbody tr");
    bodyRows[0].innerHTML = "<td>누적 던진 횟수</td>";
    bodyRows[1].innerHTML = "<td>앞면이 나온 횟수</td>";
    bodyRows[2].innerHTML = "<td>뒷면이 나온 횟수</td>";
    bodyRows[3].innerHTML = "<td>앞면 상대도수</td>";
    bodyRows[4].innerHTML = "<td>뒷면 상대도수</td>";

    showResultsRow([]);
    drawProbChart(0, 0);
  }

    document.addEventListener("keydown", function(event) {
      if (event.code === "Space") {
        flipMultipleWithRow(10);
      }
    });

    // ---- Bar chart (확률 막대그래프) ---
    function drawProbChart(headsP, tailsP) {
      // headsP, tailsP: (0 ~ 1)
      const ctx = document.getElementById("probChart").getContext("2d");
      ctx.clearRect(0, 0, 220, 180);

      // Y축: 0.0~1.0, 각 막대 간 여유 20px
      const chartHeight = 120;
      const barWidth = 50;
      const barGap = 40;
      const baseX = 40;
      const baseY = 150;

      // 바 색
      const colorHead = "#55aaff";
      const colorTail = "#ffcc55";
      // Draw X, Y axis
      ctx.strokeStyle = "#666";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(baseX-20, baseY-chartHeight);
      ctx.lineTo(baseX-20, baseY);
      ctx.lineTo(baseX+2*barWidth+barGap, baseY);
      ctx.stroke();

      // 그리드 및 0.5 이론확률선
      ctx.strokeStyle = "#aaa";
      ctx.lineWidth = 1;
      ctx.setLineDash([4,3]);
      // 0.5 이론 확률선
      ctx.beginPath();
      ctx.moveTo(baseX-20, baseY-chartHeight/2);
      ctx.lineTo(baseX+2*barWidth+barGap, baseY-chartHeight/2);
      ctx.stroke();
      ctx.setLineDash([]);

      // 앞면
      ctx.fillStyle = colorHead;
      ctx.fillRect(baseX, baseY - chartHeight*headsP, barWidth, chartHeight*headsP);
      // 뒷면
      ctx.fillStyle = colorTail;
      ctx.fillRect(baseX + barWidth + barGap, baseY - chartHeight*tailsP, barWidth, chartHeight*tailsP);

      // 라벨 및 값
      ctx.fillStyle = "#333";
      ctx.font = "bold 13px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("앞면", baseX+barWidth/2, baseY+18);
      ctx.fillText("뒷면", baseX+barWidth+barGap+barWidth/2, baseY+18);

      ctx.font = "13px sans-serif";
      ctx.fillText((headsP*100).toFixed(1) + "%", baseX+barWidth/2, baseY - chartHeight*headsP - 8);
      ctx.fillText((tailsP*100).toFixed(1) + "%", baseX+barWidth+barGap+barWidth/2, baseY - chartHeight*tailsP - 8);

      // Y축 값 (0.0, 0.5, 1.0)
      ctx.textAlign = "right";
      ctx.font = "11px sans-serif";
      ctx.fillStyle = "#888";
      ctx.fillText("1.0", baseX-22, baseY-chartHeight+5);
      ctx.fillText("0.5", baseX-22, baseY-chartHeight/2+5);
      ctx.fillText("0.0", baseX-22, baseY+4);
    }
    // 최초 0,0 그래프
    drawProbChart(0,0);
  </script>
</body>
</html>
